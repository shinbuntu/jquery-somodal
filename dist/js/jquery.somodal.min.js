!function(a){var b={defaults:{classPrefix:"soModalDefault",closeHTML:'<a title="Fermer" href="#"></a>',modalClasses:null,closeOnEscape:!0,init:null,"in":null,out:null},content:{body:""},keepFocus:function(a){if(a){var b=a.find(this.tabbableElements),c=b[0],d=b[b.length-1],e=function(a){var b=a.which||a.keyCode;9===b&&(a.preventDefault?a.preventDefault():a.returnValue=!1,c.focus())};d&&d.addEventListener("keydown",e,!1)}},tabIndex:function(b,c){if(a(this.tabbableElements).attr("tabIndex",c?-1:0),b){var d=b.find(this.tabbableElements);d.attr("tabIndex",c?0:-1)}},elems:{containerFixed:null,overlay:null,modal:null,close:null},tabbableElements:"a[href], area[href], input:not([disabled]),select:not([disabled]), textarea:not([disabled]),button:not([disabled]), iframe, object, embed, *[tabindex],*[contenteditable]",init:function(b,c,d){this.options=a.extend({},this.defaults,c),this.content.body=b,this.open(d),this.bindEvents()},unBindEvents:function(){a(window).off("resize",this.resize),a(document).off("keydown",this.keyDown)},bindEvents:function(){var b=this;a(window).resize(this.resize),this.elems.containerFixed.bind("click",function(a){a.target==this&&b.close()}),this.elems.close.bind("click",function(a){b.close(),a.preventDefault()}),a(document).keydown(this.keyDown),this.elems.containerFixed.bind("DOMNodeRemoved",function(c){c.target===b.elems.modal.get(0)&&(b.elems.containerFixed.remove(),b.elems.containerFixed=null,b.elems.modal=null,a("body").removeClass("soModalOpen"),a(document).trigger("closed.so.modal"))})},accessibility:function(a){a&&this.keepFocus(this.elems.modal),this.tabIndex(this.elems.modal,a)},open:function(b){var c=this;this.elems.overlay||(this.elems.overlay=a("<div>").addClass("soModalOverlay").addClass(this.options.classPrefix+"Overlay").addClass(this.options.classPrefix+"OverlayInit")),this.elems.overlay.appendTo("body"),this.elems.containerFixed=a("<div>").addClass("soModalContainerFixed"),this.elems.containerFixed.appendTo("body"),this.elems.modal=a("<div>").addClass("soModal").addClass(this.options.modalClasses).addClass(this.options.classPrefix+"Modal"),this.elems.modal.html(this.content.body),this.elems.modal.appendTo(this.elems.containerFixed),this.options.closeHTML?(this.elems.close=a(this.options.closeHTML).addClass("soModalClose").addClass(this.options.classPrefix+"Close"),this.elems.close.appendTo(this.elems.modal)):this.elems.close=a("."+this.options.classPrefix+"Close"),a("body").addClass("soModalOpen"),this.updateSize(),this.updatePosition(),this.elems.modal.addClass(this.options.classPrefix+"ModalInit"),this.elems.overlay.delay(1).queue(function(){c.elems.overlay.addClass(c.options.classPrefix+"OverlayIn").removeClass(c.options.classPrefix+"OverlayInit"),c.elems.overlay.dequeue()}),this.elems.modal.delay(1).queue(function(){c.elems.modal.addClass(c.options.classPrefix+"ModalIn").removeClass(c.options.classPrefix+"ModalInit"),c.elems.modal.dequeue()}),a.isFunction(this.options.init)&&this.options.init.call(this,this.elems.modal,this.elems.overlay,b),a.isFunction(this.options.in)&&this.options.in.call(this,this.elems.modal,this.elems.overlay,b),this.accessibility(!0)},close:function(b){var c=this;this.elems.overlay.delay(1).queue(function(){c.elems.overlay.addClass(c.options.classPrefix+"OverlayOut").removeClass(c.options.classPrefix+"OverlayIn"),c.elems.overlay.dequeue()}),this.elems.modal.delay(1).queue(function(){c.elems.modal.addClass(c.options.classPrefix+"ModalOut").removeClass(c.options.classPrefix+"ModalIn"),c.elems.modal.dequeue()}),a.isFunction(this.options.out)?this.options.out.call(this,this.elems.modal,this.elems.overlay,b):(this.elems.overlay.remove(),this.elems.modal.remove()),this.accessibility(!1),this.unBindEvents()},isOpen:function(){return this.elems.modal&&this.elems.modal.length>0},getDimensions:function(){var b=[a(window).width(),a(window).height()];return b},updateSize:function(){var a=this.getDimensions();this.elems.overlay.css({width:a[0],height:a[1]}),this.elems.modal.finalWidth=this.elems.modal.outerWidth(!0),this.elems.modal.finalHeight=this.elems.modal.outerHeight(!0)},updatePosition:function(){var a=this.getDimensions(),b=Math.max(0,(a[1]-this.elems.modal.outerHeight(!0))/2)+"px",c=Math.max(0,(a[0]-this.elems.modal.outerWidth(!0))/2)+"px";this.elems.modal.css("top",b),this.elems.modal.css("left",c),this.elems.modal.finalPosition=this.elems.modal.position()},keyDown:function(a){var c=b;c.options.closeOnEscape&&a.keyCode&&27===a.keyCode&&(c.close(),a.preventDefault())},resize:function(){b.updateSize(),b.updatePosition()}};a.support.transition||(a.fn.transition=a.fn.animate),a.soModal={open:function(c,d){b.isOpen()?(a(document).one("closed.so.modal",function(){b.isOpen()||b.init(c,d,!0)}),b.close(!0)):b.init(c,d)},close:function(){b.close()}}}(jQuery);